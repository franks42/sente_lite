<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Direct Trove Macros Test</title>

  <!-- Load Scittle core -->
  <script src="https://cdn.jsdelivr.net/npm/scittle@0.7.28/dist/scittle.js"
          type="application/javascript"></script>

  <!-- Load Trove source files -->
  <script src="src/taoensso/trove/utils.cljc" type="application/x-scittle"></script>
  <script src="src/taoensso/trove/console.cljc" type="application/x-scittle"></script>
  <script src="src/taoensso/trove.cljc" type="application/x-scittle"></script>

  <style>
    body { font-family: monospace; margin: 20px; }
    h1 { color: #333; }
    .result { background: white; border: 1px solid #ddd; padding: 15px; margin-top: 20px; }
    .test { margin: 10px 0; padding: 10px; border-left: 3px solid #ccc; }
    .pass { border-left-color: green; background: #f0fff0; }
    .fail { border-left-color: red; background: #fff0f0; }
  </style>
</head>
<body>
  <h1>üß™ Direct Trove Macros Test (No Wrapper!)</h1>
  
  <div class="result">
    <h2>Test Results</h2>
    <div id="results"></div>
  </div>

  <script type="application/x-scittle">
    ;; Test 1: Can we require Trove and use its macros directly?
    (println "\n=== Test 1: Require Trove with :refer ===")
    
    (try
      (require '[taoensso.trove :refer [log!]])
      (println "‚úÖ Successfully required taoensso.trove with :refer")
      (catch :default e
        (println (str "‚ùå Failed to require: " e))))
  </script>

  <script type="application/x-scittle">
    ;; Test 2: Check if log! is a macro
    (println "\n=== Test 2: Is trove/log! a macro? ===")
    
    (try
      (let [log-meta (meta #'taoensso.trove/log!)]
        (println (str "log! metadata: " log-meta))
        (if (:macro log-meta)
          (println "‚úÖ taoensso.trove/log! IS a macro!")
          (println "‚ùå taoensso.trove/log! is NOT a macro")))
      (catch :default e
        (println (str "‚ùå Error checking metadata: " e))))
  </script>

  <script type="application/x-scittle">
    ;; Test 3: Try to use the macro directly
    (println "\n=== Test 3: Use trove/log! macro directly ===")
    
    (try
      (taoensso.trove/log! {:level :info :id :test/direct-macro :data {:message "Direct macro test"}})
      (println "‚úÖ Direct trove/log! macro call succeeded!")
      (catch :default e
        (println (str "‚ùå Direct macro call failed: " e))))
  </script>

  <script type="application/x-scittle">
    ;; Test 4: Try all log levels
    (println "\n=== Test 4: Test all log levels with trove/log! ===")
    
    (try
      (taoensso.trove/log! {:level :trace :id :test/trace})
      (taoensso.trove/log! {:level :debug :id :test/debug})
      (taoensso.trove/log! {:level :info :id :test/info})
      (taoensso.trove/log! {:level :warn :id :test/warn})
      (taoensso.trove/log! {:level :error :id :test/error})
      (taoensso.trove/log! {:level :fatal :id :test/fatal})
      (println "‚úÖ All log levels work!")
      (catch :default e
        (println (str "‚ùå Log level test failed: " e))))
  </script>

  <script type="application/x-scittle">
    ;; Test 5: Try with complex data
    (println "\n=== Test 5: Complex data logging ===")
    
    (try
      (taoensso.trove/log! 
        {:level :info 
         :id :test/complex-data
         :data {:user {:id 123 :name "Test User"}
                :action "login"
                :timestamp (js/Date.now)}})
      (println "‚úÖ Complex data logging works!")
      (catch :default e
        (println (str "‚ùå Complex data test failed: " e))))
  </script>

  <script type="application/x-scittle">
    ;; Test 6: Try with error
    (println "\n=== Test 6: Error logging ===")
    
    (try
      (try
        (throw (js/Error. "Test error"))
        (catch js/Error e
          (taoensso.trove/log! 
            {:level :error 
             :id :test/error-logging
             :error e})))
      (println "‚úÖ Error logging works!")
      (catch :default e
        (println (str "‚ùå Error logging test failed: " e))))
  </script>

  <script type="application/x-scittle">
    ;; Test 7: Try with :refer
    (println "\n=== Test 7: Use log! with :refer ===")
    
    (try
      (require '[taoensso.trove :refer [log!]])
      (log! {:level :info :id :test/with-refer :data {:message "Using :refer"}})
      (println "‚úÖ :refer import works!")
      (catch :default e
        (println (str "‚ùå :refer test failed: " e))))
  </script>

  <script type="application/x-scittle">
    ;; Test 8: Check if set-log-fn! is a macro
    (println "\n=== Test 8: Is set-log-fn! a macro? ===")
    
    (try
      (let [set-meta (meta #'taoensso.trove/set-log-fn!)]
        (println (str "set-log-fn! metadata: " set-meta))
        (if (:macro set-meta)
          (println "‚úÖ taoensso.trove/set-log-fn! IS a macro!")
          (println "‚ùå taoensso.trove/set-log-fn! is NOT a macro")))
      (catch :default e
        (println (str "‚ùå Error checking set-log-fn! metadata: " e))))
  </script>

  <script type="application/x-scittle">
    ;; Final Summary
    (println "\n" (apply str (repeat 60 "=")))
    (println "FINAL SUMMARY")
    (println (apply str (repeat 60 "=")))
    (println "\nDirect Trove Macros Test Results:")
    (println "‚úÖ Can we use Trove macros directly without wrapper?")
    (println "‚úÖ Do they work with :refer?")
    (println "‚úÖ Are they real macros?")
    (println "\nIf all tests pass:")
    (println "üéâ WE DON'T NEED THE WRAPPER!")
    (println "üéâ We can use Trove macros directly in Scittle!")
  </script>
</body>
</html>
