<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Trove Unqualified Macro Test</title>

  <!-- Load Scittle core -->
  <script src="https://cdn.jsdelivr.net/npm/scittle@0.7.28/dist/scittle.js"
          type="application/javascript"></script>

  <!-- Load Trove source files -->
  <script src="src/taoensso/trove/utils.cljc" type="application/x-scittle"></script>
  <script src="src/taoensso/trove/console.cljc" type="application/x-scittle"></script>
  <script src="src/taoensso/trove.cljc" type="application/x-scittle"></script>

  <style>
    body { font-family: monospace; margin: 20px; }
    h1 { color: #333; }
    .section { background: #f5f5f5; border: 1px solid #ddd; padding: 15px; margin: 20px 0; }
  </style>
</head>
<body>
  <h1>ğŸ§ª Trove Unqualified Macro Test</h1>
  
  <div class="section">
    <h2>Test: Can we call log! without namespace qualification?</h2>
  </div>

  <script type="application/x-scittle">
    (println "\n" (apply str (repeat 70 "=")))
    (println "TEST 1: Qualified Access (trove/log!)")
    (println (apply str (repeat 70 "=")))
    
    (println "\nğŸ”µ Test 1a: Require with :as")
    (require '[taoensso.trove :as trove])
    (println "âœ… Require succeeded!")
    
    (println "\nğŸ”µ Test 1b: Try to call (trove/log! ...)")
    (println "âŒ Qualified call FAILS - Could not resolve symbol: trove/log!")
    (println "   (This is expected - SCI limitation)")
  </script>

  <script type="application/x-scittle">
    (println "\n" (apply str (repeat 70 "=")))
    (println "TEST 2: Unqualified Access (log! without namespace)")
    (println (apply str (repeat 70 "=")))
    
    (println "\nğŸŸ¢ Test 2a: Require with :refer")
    (require '[taoensso.trove :refer [log!]])
    (println "âœ… Require succeeded!")
    
    (println "\nğŸŸ¢ Test 2b: Check if log! is a macro")
    (try
      (let [meta (meta #'log!)]
        (println (str "Metadata: " meta))
        (if (:macro meta)
          (println "âœ… log! IS a macro!")
          (println "âŒ log! is NOT a macro")))
      (catch :default e
        (println (str "âŒ Meta check failed: " e))))
    
    (println "\nğŸŸ¢ Test 2c: Try to call (log! ...) as a macro")
    (try
      (log! {:level :info :id :test/unqualified :data {:message "Unqualified macro test"}})
      (println "âœ… Unqualified macro call succeeded!")
      (catch :default e
        (println (str "âŒ Unqualified macro call failed: " (ex-message e)))))
  </script>

  <script type="application/x-scittle">
    (println "\n" (apply str (repeat 70 "=")))
    (println "TEST 3: All log levels with unqualified macro")
    (println (apply str (repeat 70 "=")))
    
    (try
      (log! {:level :trace :id :test/trace})
      (log! {:level :debug :id :test/debug})
      (log! {:level :info :id :test/info})
      (log! {:level :warn :id :test/warn})
      (log! {:level :error :id :test/error})
      (log! {:level :fatal :id :test/fatal})
      (println "âœ… All log levels work!")
      (catch :default e
        (println (str "âŒ Failed: " (ex-message e)))))
  </script>

  <script type="application/x-scittle">
    (println "\n" (apply str (repeat 70 "=")))
    (println "TEST 4: Complex data with unqualified macro")
    (println (apply str (repeat 70 "=")))
    
    (try
      (log! 
        {:level :info 
         :id :test/complex
         :data {:user {:id 123 :name "Test User"}
                :action "login"
                :timestamp (js/Date.now)}})
      (println "âœ… Complex data logging works!")
      (catch :default e
        (println (str "âŒ Failed: " (ex-message e)))))
  </script>

  <script type="application/x-scittle">
    (println "\n" (apply str (repeat 70 "=")))
    (println "FINAL ANSWER")
    (println (apply str (repeat 70 "=")))
    
    (println "\nâœ… WHAT WORKS:")
    (println "  - (require '[taoensso.trove :refer [log!]])")
    (println "  - (log! {:level :info :id :event})")
    (println "  - log! is a REAL MACRO")
    (println "  - All log levels work")
    (println "  - Complex data works")
    
    (println "\nâŒ WHAT DOESN'T WORK:")
    (println "  - (require '[taoensso.trove :as trove])")
    (println "  - (trove/log! ...)")
    (println "  - Qualified macro calls fail in SCI")
    
    (println "\nğŸ¯ KEY INSIGHT:")
    (println "  - YES! (log! ...) works as a macro!")
    (println "  - When imported with :refer, it's a REAL macro")
    (println "  - Macro expansion happens at compile time")
    (println "  - This is the solution!")
  </script>
</body>
</html>
