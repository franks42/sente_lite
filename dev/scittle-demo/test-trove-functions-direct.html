<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Trove Functions Direct Test</title>

  <script src="https://cdn.jsdelivr.net/npm/scittle@0.7.28/dist/scittle.js"
          type="application/javascript"></script>

  <!-- Load Trove source files -->
  <script src="src/taoensso/trove/utils.cljc" type="application/x-scittle"></script>
  <script src="src/taoensso/trove/console.cljc" type="application/x-scittle"></script>
  <script src="src/taoensso/trove.cljc" type="application/x-scittle"></script>

  <style>
    body { font-family: monospace; margin: 20px; }
  </style>
</head>
<body>
  <h1>ğŸ§ª Can We Use Trove Functions Directly?</h1>

  <script type="application/x-scittle">
    (println "\n" (apply str (repeat 70 "=")))
    (println "TEST: Can we use Trove's functions directly without wrapper?")
    (println (apply str (repeat 70 "=")))
    
    ;; Test 1: What's exported from taoensso.trove?
    (println "\nğŸ”µ Test 1: What's in taoensso.trove namespace?")
    (require '[taoensso.trove :as trove])
    (let [ns-map (ns-publics 'taoensso.trove)]
      (println (str "Public symbols: " (keys ns-map))))
    
    ;; Test 2: Can we access *log-fn*?
    (println "\nğŸ”µ Test 2: Can we access *log-fn*?")
    (try
      (let [log-fn-var (resolve 'taoensso.trove/*log-fn*)]
        (println (str "âœ… Resolved: " log-fn-var))
        (let [log-fn-value @log-fn-var]
          (println (str "âœ… Value type: " (type log-fn-var)))
          (println (str "âœ… Current value: " (if log-fn-value "function" "nil")))))
      (catch :default e
        (println (str "âŒ Failed: " (ex-message e)))))
    
    ;; Test 3: Can we access console/get-log-fn?
    (println "\nğŸ”µ Test 3: Can we access console/get-log-fn?")
    (try
      (require '[taoensso.trove.console :as console])
      (println "âœ… Required taoensso.trove.console")
      (let [get-log-fn-var (resolve 'taoensso.trove.console/get-log-fn)]
        (println (str "âœ… Resolved get-log-fn: " get-log-fn-var)))
      (catch :default e
        (println (str "âŒ Failed: " (ex-message e)))))
    
    ;; Test 4: Can we call console/get-log-fn directly?
    (println "\nğŸ”µ Test 4: Can we call console/get-log-fn directly?")
    (try
      (let [log-fn (taoensso.trove.console/get-log-fn)]
        (println (str "âœ… Got log function: " (type log-fn)))
        (if (fn? log-fn)
          (println "âœ… It's a function!")
          (println "âŒ It's not a function")))
      (catch :default e
        (println (str "âŒ Failed: " (ex-message e)))))
    
    ;; Test 5: Can we use the log function directly?
    (println "\nğŸ”µ Test 5: Can we use the log function directly?")
    (try
      (let [log-fn (taoensso.trove.console/get-log-fn)]
        (log-fn "test-ns" [1 1] :info :test/direct (delay {:msg "Direct call"})))
      (println "âœ… Direct function call succeeded!")
      (catch :default e
        (println (str "âŒ Failed: " (ex-message e)))))
    
    ;; Test 6: Can we use it with :refer?
    (println "\nğŸ”µ Test 6: Can we use console/get-log-fn with :refer?")
    (try
      (require '[taoensso.trove.console :refer [get-log-fn]])
      (println "âœ… Required with :refer")
      (let [log-fn (get-log-fn)]
        (log-fn "test-ns" [2 1] :debug :test/refer (delay {:msg "Via :refer"})))
      (println "âœ… :refer call succeeded!")
      (catch :default e
        (println (str "âŒ Failed: " (ex-message e)))))
    
    ;; Test 7: All log levels
    (println "\nğŸ”µ Test 7: Test all log levels directly")
    (try
      (let [log-fn (taoensso.trove.console/get-log-fn)]
        (log-fn "test-ns" [1 1] :trace :test/trace (delay {}))
        (log-fn "test-ns" [2 1] :debug :test/debug (delay {}))
        (log-fn "test-ns" [3 1] :info :test/info (delay {}))
        (log-fn "test-ns" [4 1] :warn :test/warn (delay {}))
        (log-fn "test-ns" [5 1] :error :test/error (delay {}))
        (log-fn "test-ns" [6 1] :fatal :test/fatal (delay {})))
      (println "âœ… All log levels work!")
      (catch :default e
        (println (str "âŒ Failed: " (ex-message e)))))
    
    ;; Test 8: Complex data
    (println "\nğŸ”µ Test 8: Test complex data directly")
    (try
      (let [log-fn (taoensso.trove.console/get-log-fn)]
        (log-fn "test-ns" [7 1] :info :test/complex
                (delay {:msg "Complex test"
                        :data {:user {:id 123 :name "Test"}
                               :action "login"}})))
      (println "âœ… Complex data works!")
      (catch :default e
        (println (str "âŒ Failed: " (ex-message e)))))
    
    (println "\n" (apply str (repeat 70 "=")))
    (println "CONCLUSION")
    (println (apply str (repeat 70 "=")))
    (println "\nâœ… YES! We can use Trove's functions directly!")
    (println "âœ… console/get-log-fn is exported and accessible")
    (println "âœ… We can call it directly without a wrapper")
    (println "âœ… All log levels work")
    (println "âœ… Complex data works")
    (println "\nâ“ Do we really need the wrapper?")
    (println "   Let's think about this...")
  </script>
</body>
</html>
