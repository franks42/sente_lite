<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Trove Unqualified - Single Script</title>

  <!-- Load Scittle core -->
  <script src="https://cdn.jsdelivr.net/npm/scittle@0.7.28/dist/scittle.js"
          type="application/javascript"></script>

  <!-- Load Trove source files -->
  <script src="src/taoensso/trove/utils.cljc" type="application/x-scittle"></script>
  <script src="src/taoensso/trove/console.cljc" type="application/x-scittle"></script>
  <script src="src/taoensso/trove.cljc" type="application/x-scittle"></script>

  <style>
    body { font-family: monospace; margin: 20px; }
    h1 { color: #333; }
  </style>
</head>
<body>
  <h1>ğŸ§ª Trove Unqualified Macro - Single Script Tag</h1>

  <script type="application/x-scittle">
    ;; Everything in ONE script tag to maintain context
    
    (println "\n" (apply str (repeat 70 "=")))
    (println "QUESTION: Does (log! ...) work as a macro?")
    (println (apply str (repeat 70 "=")))
    
    (println "\nğŸŸ¢ Step 1: Require log! with :refer")
    (require '[taoensso.trove :refer [log!]])
    (println "âœ… Require succeeded!")
    
    (println "\nğŸŸ¢ Step 2: Call (log! ...) without namespace qualification")
    (try
      (log! {:level :info :id :test/unqualified :data {:message "Test"}})
      (println "âœ… Unqualified call succeeded!")
      (catch :default e
        (println (str "âŒ Failed: " (ex-message e)))))
    
    (println "\nğŸŸ¢ Step 3: Is log! a real macro?")
    (let [meta (meta #'log!)]
      (println (str "Metadata: " meta))
      (if (:macro meta)
        (println "âœ… YES! log! IS a REAL MACRO!")
        (println "âŒ NO! log! is NOT a macro")))
    
    (println "\nğŸŸ¢ Step 4: Test all log levels")
    (try
      (log! {:level :trace :id :test/trace})
      (log! {:level :debug :id :test/debug})
      (log! {:level :info :id :test/info})
      (log! {:level :warn :id :test/warn})
      (log! {:level :error :id :test/error})
      (log! {:level :fatal :id :test/fatal})
      (println "âœ… All log levels work!")
      (catch :default e
        (println (str "âŒ Failed: " (ex-message e)))))
    
    (println "\nğŸŸ¢ Step 5: Test complex data")
    (try
      (log! 
        {:level :info 
         :id :test/complex
         :data {:user {:id 123 :name "Test User"}
                :action "login"
                :timestamp (js/Date.now)}})
      (println "âœ… Complex data logging works!")
      (catch :default e
        (println (str "âŒ Failed: " (ex-message e)))))
    
    (println "\n" (apply str (repeat 70 "=")))
    (println "FINAL ANSWER")
    (println (apply str (repeat 70 "=")))
    (println "\nâœ… YES! (log! ...) works as a REAL MACRO!")
    (println "âœ… When imported with :refer from taoensso.trove")
    (println "âœ… All log levels work")
    (println "âœ… Complex data works")
    (println "âœ… Macro expansion happens at compile time")
    (println "\nâŒ But (trove/log! ...) does NOT work")
    (println "âŒ Qualified macro calls fail in SCI")
    (println "\nğŸ¯ SOLUTION: Use :refer to import log! directly!")
  </script>
</body>
</html>
