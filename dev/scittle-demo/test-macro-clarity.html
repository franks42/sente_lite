<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Macro Clarity Test</title>

  <!-- Load Scittle core -->
  <script src="https://cdn.jsdelivr.net/npm/scittle@0.7.28/dist/scittle.js"
          type="application/javascript"></script>

  <!-- Load external file with macros -->
  <script src="my-test-macros.cljs" type="application/x-scittle"></script>

  <style>
    body { font-family: monospace; margin: 20px; }
    h1 { color: #333; }
    .section { background: #f5f5f5; border: 1px solid #ddd; padding: 15px; margin: 20px 0; }
    .test { margin: 10px 0; padding: 10px; border-left: 3px solid #ccc; }
    .pass { border-left-color: green; background: #f0fff0; }
    .fail { border-left-color: red; background: #fff0f0; }
  </style>
</head>
<body>
  <h1>ğŸ§ª Macro Clarity Test</h1>
  
  <div class="section">
    <h2>Part 1: Access Macros with :refer</h2>
    <div id="part2"></div>
  </div>

  <div class="section">
    <h2>Part 3: Access Functions with :refer</h2>
    <div id="part3"></div>
  </div>

  <div class="section">
    <h2>Part 4: Qualified Access</h2>
    <div id="part4"></div>
  </div>

  <script type="application/x-scittle">
    (println "\n" (apply str (repeat 70 "=")))
    (println "PART 1: ACCESS MACROS WITH :refer")
    (println (apply str (repeat 70 "=")))
    
    (println "\nğŸ”µ Test 1a: Require macro with :refer")
    (try
      (require '[my-test-macros :refer [simple-macro]])
      (println "âœ… Require succeeded!")
      (catch :default e
        (println (str "âŒ Require failed: " e))))
    
    (println "\nğŸ”µ Test 1b: Call macro with :refer")
    (try
      (simple-macro "test-value")
      (println "âœ… Macro call succeeded!")
      (catch :default e
        (println (str "âŒ Macro call failed: " e))))
    
    (println "\nğŸ”µ Test 1c: Check if it's a macro")
    (try
      (let [meta (meta #'simple-macro)]
        (println (str "Metadata: " meta))
        (if (:macro meta)
          (println "âœ… simple-macro IS a macro!")
          (println "âŒ simple-macro is NOT a macro")))
      (catch :default e
        (println (str "âŒ Meta check failed: " e))))
  </script>

  <script type="application/x-scittle">
    (println "\n" (apply str (repeat 70 "=")))
    (println "PART 2: ACCESS FUNCTIONS WITH :refer")
    (println (apply str (repeat 70 "=")))
    
    (println "\nğŸŸ¡ Test 2a: Require function with :refer")
    (try
      (require '[my-test-macros :refer [simple-function]])
      (println "âœ… Require succeeded!")
      (catch :default e
        (println (str "âŒ Require failed: " e))))
    
    (println "\nğŸŸ¡ Test 2b: Call function with :refer")
    (try
      (simple-function "test-value")
      (println "âœ… Function call succeeded!")
      (catch :default e
        (println (str "âŒ Function call failed: " e))))
    
    (println "\nğŸŸ¡ Test 2c: Check if it's a function")
    (try
      (let [meta (meta #'simple-function)]
        (println (str "Metadata: " meta))
        (if (fn? simple-function)
          (println "âœ… simple-function IS a function!")
          (println "âŒ simple-function is NOT a function")))
      (catch :default e
        (println (str "âŒ Meta check failed: " e))))
  </script>

  <script type="application/x-scittle">
    (println "\n" (apply str (repeat 70 "=")))
    (println "PART 3: QUALIFIED ACCESS")
    (println (apply str (repeat 70 "=")))
    
    (println "\nğŸ”µ Test 3a: Require namespace")
    (try
      (require '[my-test-macros :as mtm])
      (println "âœ… Require succeeded!")
      (catch :default e
        (println (str "âŒ Require failed: " e))))
    
    (println "\nğŸ”µ Test 3b: Call macro with qualified name")
    (try
      (mtm/simple-macro "test-value")
      (println "âœ… Qualified macro call succeeded!")
      (catch :default e
        (println (str "âŒ Qualified macro call failed: " e))))
    
    (println "\nğŸŸ¡ Test 3c: Call function with qualified name")
    (try
      (mtm/simple-function "test-value")
      (println "âœ… Qualified function call succeeded!")
      (catch :default e
        (println (str "âŒ Qualified function call failed: " e))))
  </script>

  <script type="application/x-scittle">
    (println "\n" (apply str (repeat 70 "=")))
    (println "FINAL SUMMARY")
    (println (apply str (repeat 70 "=")))
    
    (println "\nâœ… What WORKS:")
    (println "  - Load external .cljs files with macros")
    (println "  - Access functions with :refer")
    (println "  - Call functions with qualified names")
    (println "  - Access macros with :refer")
    (println "  - Call macros with :refer")
    
    (println "\nâŒ What DOESN'T WORK:")
    (println "  - Call macros with qualified names (mtm/simple-macro)")
    
    (println "\nğŸ¯ KEY INSIGHT:")
    (println "  - Macros work with :refer")
    (println "  - Macros DON'T work with qualified names")
    (println "  - Functions work both ways")
  </script>
</body>
</html>
